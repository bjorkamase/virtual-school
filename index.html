<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sekolah Virtual Fullscreen</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      /* LAYAR AWAL (TOMBOL START) */
      #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #2c3e50; z-index: 9999;
        display: flex; justify-content: center; align-items: center;
      }
      .start-btn {
        padding: 20px 40px; font-size: 24px; font-weight: bold;
        color: white; background: #27ae60; border: none; border-radius: 50px;
        cursor: pointer; box-shadow: 0 10px #219150;
      }
      .start-btn:active { box-shadow: 0 5px #219150; transform: translateY(4px); }

      /* MENU PILIH PERAN */
      #role-menu {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 9998;
        display: none; justify-content: center; align-items: center; flex-direction: column;
      }
      .role-box { background: white; padding: 20px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; }
      .btn { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; }

      /* FITUR CHAT */
      #chat-container {
        position: fixed; bottom: 20px; left: 10px; width: 250px;
        z-index: 1000; display: none; flex-direction: column;
      }
      #chat-box {
        height: 150px; background: rgba(0,0,0,0.6); color: white;
        padding: 10px; border-radius: 10px 10px 0 0; overflow-y: auto; font-size: 13px;
      }
      #chat-input-row { display: flex; }
      #chat-input { flex: 1; padding: 10px; border: none; border-radius: 0 0 0 10px; }
      #send-btn { padding: 10px; background: #3498db; color: white; border: none; border-radius: 0 0 10px 0; }
    </style>
  </head>
  <body>

    <div id="start-screen">
      <button class="start-btn" onclick="showRoles()">MULAI BERMAIN</button>
    </div>

    <div id="role-menu">
      <div class="role-box">
        <h2 style="margin-top:0">PILIH PERAN</h2>
        <button class="btn" style="background:#e74c3c" onclick="enterGame('Kepala Sekolah')">KEPALA SEKOLAH</button>
        <button class="btn" style="background:#3498db" onclick="enterGame('Guru')">GURU</button>
        <button class="btn" style="background:#2ecc71" onclick="enterGame('Murid')">MURID</button>
      </div>
    </div>

    <div id="chat-container">
      <div id="chat-box" id="messages"></div>
      <div id="chat-input-row">
        <input type="text" id="chat-input" placeholder="Tulis pesan...">
        <button id="send-btn" onclick="sendChat()">Kirim</button>
      </div>
    </div>

    <a-scene id="scene" embedded="false">
      <a-entity environment="preset: contact; dressingAmount: 30;"></a-entity>

      <a-box position="0 2 -8" width="12" height="5" color="#ecf0f1"></a-box>
      <a-box position="0 2.5 -7.8" width="7" height="3" color="#1B3022"></a-box>
      <a-text id="papan-tulis" value="Selamat Datang!" position="0 2.5 -7.7" align="center" width="6" color="white"></a-text>
      
      <a-cone position="0 6 -8" radius-bottom="10" height="3" segments-radial="4" rotation="0 45 0" color="#c0392b"></a-cone>

      <a-entity id="rig" position="0 1.6 5">
        <a-camera look-controls="touchEnabled: true" wasd-controls="acceleration: 100"></a-camera>
      </a-entity>
    </a-scene>

    <script>
      let myRole = "";

      function showRoles() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('role-menu').style.display = 'flex';
      }

      function enterGame(role) {
        myRole = role;
        document.getElementById('role-menu').style.display = 'none';
        document.getElementById('chat-container').style.display = 'flex';
        
        addMessage("SISTEM", "Selamat datang " + role + "!", "yellow");
      }

      function sendChat() {
        const input = document.getElementById('chat-input');
        const text = input.value;
        if (text.trim() !== "") {
          addMessage(myRole, text, "cyan");
          
          // Jika ingin fitur guru update papan tulis lewat chat:
          if ((myRole === "Guru" || myRole === "Kepala Sekolah") && text.startsWith("/papan ")) {
             const pesanPapan = text.replace("/papan ", "");
             document.getElementById('papan-tulis').setAttribute('value', pesanPapan);
             addMessage("SISTEM", "Papan tulis diupdate!", "lime");
          }
          
          input.value = "";
        }
      }

      function addMessage(sender, text, color) {
        const chatBox = document.getElementById('chat-box');
        const msg = document.createElement('div');
        msg.innerHTML = `<b style="color:${color}">[${sender}]:</b> ${text}`;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Supaya bisa tekan Enter untuk kirim chat
      document.getElementById('chat-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendChat();
      });
    </script>
  </body>
</html>
