<!DOCTYPE html>
<html>
  <head>
    <title>My Virtual School World</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.5.0/socket.io.slim.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.11.0/dist/networked-aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>

    <style>
      /* MENU STYLING */
      #ui-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; color: white; font-family: 'Segoe UI', sans-serif; }
      .menu-box { background: #222; padding: 30px; border-radius: 20px; border: 3px solid #444; text-align: center; }
      .btn { padding: 15px 30px; margin: 10px; font-size: 18px; cursor: pointer; border: none; border-radius: 10px; color: white; font-weight: bold; transition: 0.2s; }
      .btn-h { background: #e74c3c; } .btn-t { background: #3498db; } .btn-s { background: #2ecc71; }
      .btn:hover { transform: scale(1.1); filter: brightness(1.2); }

      /* CHAT STYLING */
      #chat-ui { position: fixed; bottom: 20px; left: 20px; width: 300px; height: 250px; background: rgba(0,0,0,0.6); border-radius: 10px; z-index: 100; display: none; flex-direction: column; padding: 10px; border: 1px solid rgba(255,255,255,0.2); }
      #messages { flex: 1; overflow-y: auto; color: white; font-family: sans-serif; font-size: 14px; margin-bottom: 5px; }
      #chat-input { background: rgba(255,255,255,0.1); border: 1px solid #555; color: white; padding: 8px; border-radius: 5px; }
    </style>
  </head>
  <body>

    <div id="ui-overlay">
      <div class="menu-box">
        <h1>ROBLOX SCHOOL</h1>
        <p>Pick your role to enter the school:</p>
        <button class="btn btn-h" onclick="enterGame('Headmaster', '#e74c3c')">HEADMASTER</button>
        <button class="btn btn-t" onclick="enterGame('Teacher', '#3498db')">TEACHER</button>
        <button class="btn btn-s" onclick="enterGame('Student', '#2ecc71')">STUDENT</button>
      </div>
    </div>

    <div id="chat-ui">
      <div id="messages"></div>
      <input type="text" id="chat-input" placeholder="Type message & Enter...">
    </div>

    <a-scene networked-scene="room: school_lobby; debug: true; adapter: wseasyrtc;">
      
      <a-assets>
        <template id="avatar-template">
          <a-entity class="avatar">
            <a-sphere class="head" scale="0.25 0.3 0.2"></a-sphere>
            <a-box class="body" position="0 -0.4 0" scale="0.4 0.6 0.2"></a-box>
          </a-entity>
        </template>
      </a-assets>

      <a-entity environment="preset: contact; groundColor: #445; grid: cross;"></a-entity>

      <a-box position="0 2 -5" width="12" height="4" depth="0.2" color="#ddd"></a-box> <a-box position="0 2.5 -4.8" width="8" height="2" depth="0.1" color="#1B3022"></a-box> <a-text value="WELCOME TO CLASS" position="0 4 -4.8" align="center" color="black" width="10"></a-text>

      <a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" 
                camera look-controls wasd-controls position="0 1.6 5">
      </a-entity>

    </a-scene>

    <script>
      let currentRole = "";
      
      function enterGame(role, color) {
        currentRole = role;
        document.getElementById('ui-overlay').style.display = 'none';
        document.getElementById('chat-ui').style.display = 'flex';
        
        // System message
        addChatMsg("SYSTEM", "You are now the " + role, "yellow");
      }

      // CHAT LOGIC
      const input = document.getElementById('chat-input');
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && input.value !== "") {
          const text = input.value;
          addChatMsg(currentRole, text, "white");
          input.value = "";
          
          // Network sync for chat
          NAF.connection.broadcastData('chat', {txt: text, role: currentRole});
        }
      });

      function addChatMsg(role, text, color) {
        const msgDiv = document.getElementById('messages');
        const newMsg = document.createElement('div');
        newMsg.innerHTML = `<span style="color:cyan">[${role}]</span>: ${text}`;
        msgDiv.appendChild(newMsg);
        msgDiv.scrollTop = msgDiv.scrollHeight;
      }

      // Listen for other players' messages
      document.body.addEventListener('clientConnected', function (evt) {
          NAF.connection.subscribeToDataChannel('chat', (senderId, dataType, data) => {
              addChatMsg(data.role, data.txt, "white");
          });
      });
    </script>
  </body>
</html>