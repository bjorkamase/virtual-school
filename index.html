<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sekolah Virtual Pro - 4 Lantai</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <style>
      html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #2c3e50; position: fixed; font-family: sans-serif; }
      #ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: flex; justify-content: center; align-items: center; overflow-y: auto; }
      .menu-box { background: white; padding: 20px; border-radius: 15px; width: 85%; max-width: 300px; text-align: center; }
      .role-btn { width: 100%; padding: 12px; margin: 6px 0; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; }
      #exit-role { position: fixed; top: 10px; right: 10px; z-index: 2000; padding: 10px; background: #e74c3c; color: white; border: none; border-radius: 5px; display: none; }
      #chat-area { position: absolute; bottom: 15px; left: 10px; right: 10px; z-index: 1000; display: none; pointer-events: none; }
      #messages { height: 80px; background: rgba(0,0,0,0.6); color: white; padding: 8px; overflow-y: auto; border-radius: 8px 8px 0 0; pointer-events: auto; font-size: 11px; }
      .input-group { display: flex; pointer-events: auto; }
      #chat-input { flex: 1; padding: 10px; border: none; border-radius: 0 0 0 8px; font-size: 16px; }
      #send-btn { padding: 0 15px; background: #3498db; color: white; border: none; border-radius: 0 0 8px 0; }
    </style>
  </head>
  <body>

    <button id="exit-role" onclick="location.reload()">Ganti Peran</button>

    <div id="ui-overlay">
      <div class="menu-box">
        <h2>üè´ PILIH PERAN</h2>
        <button class="role-btn" style="background:#e74c3c" onclick="start('Kepala Sekolah')">KEPALA SEKOLAH</button>
        <button class="role-btn" style="background:#3498db" onclick="start('Guru')">GURU</button>
        <button class="role-btn" style="background:#2ecc71" onclick="start('Murid')">MURID</button>
      </div>
    </div>

    <div id="chat-area">
      <div id="messages"></div>
      <div class="input-group">
        <input type="text" id="chat-input" placeholder="Chat / /papan ...">
        <button id="send-btn" onclick="kirim()">Kirim</button>
      </div>
    </div>

    <a-scene vr-mode-ui="enabled: false">
      <a-entity environment="preset: contact; dressingAmount: 20;"></a-entity>
      
      <a-entity id="school-building"></a-entity>

      <a-entity id="classroom-interior" visible="false" position="100 0 100">
        <a-box width="12" height="4" depth="12" color="#ecf0f1" side="double"></a-box>
        <a-box position="0 2.5 -5.9" width="6" height="2" color="#1B3022"></a-box> <a-text id="papan-tulis" value="Kelas" position="0 2.5 -5.8" align="center" width="6"></a-text>
        
        <a-box position="-4 0.5 -4" width="1.5" height="0.8" depth="0.8" color="#8B4513"></a-box>
        
        <a-entity id="student-desks"></a-entity>

        <a-box id="exit-door" position="0 1.5 5.9" width="1.5" height="2.5" depth="0.1" color="#c0392b" class="clickable"></a-box>
        <a-text value="KELUAR KELAS" position="0 3 5.8" align="center" width="4"></a-text>
      </a-entity>

      <a-entity id="rig" position="0 1.6 15">
        <a-camera look-controls="touchEnabled: true" wasd-controls="acceleration: 100">
            <a-cursor color="yellow"></a-cursor>
        </a-camera>
      </a-entity>
    </a-scene>

    <script>
      let myRole = "";
      const building = document.getElementById('school-building');

      // 1. BUAT GEDUNG 4 LANTAI, 24 KELAS (6 Kelas per Lantai)
      for (let l = 0; l < 4; l++) { // Lantai
        for (let k = 0; k < 6; k++) { // Kelas
          let xPos = (k * 6) - 15;
          let yPos = l * 4;
          
          // Struktur Kelas Luar
          let room = document.createElement('a-entity');
          room.setAttribute('position', `${xPos} ${yPos} 0`);
          
          // Dinding & Jendela (Simulasi)
          room.innerHTML = `
            <a-box width="5.8" height="3.8" depth="6" color="#bdc3c7" opacity="0.8"></a-box>
            <a-box position="0 0.5 3" width="1.2" height="2.2" depth="0.1" color="#34495e" class="clickable" onclick="masukKelas(${l+1}, ${k+1})"></a-box>
            <a-text value="KELAS ${l+1}0${k+1}" position="0 2.2 3.1" align="center" width="4" color="black"></a-text>
            <a-box position="1.8 1.5 3" width="1.5" height="1" depth="0.05" color="lightblue" opacity="0.5"></a-box>
            <a-box position="-1.8 1.5 3" width="1.5" height="1" depth="0.05" color="lightblue" opacity="0.5"></a-box>
          `;
          building.appendChild(room);
        }
      }

      // 2. BUAT MEJA SISWA DI DALAM INTERIOR (14 Meja, tiap meja 2 kursi)
      const deskContainer = document.getElementById('student-desks');
      for (let i = 0; i < 14; i++) {
        let row = Math.floor(i / 3);
        let col = i % 3;
        let x = (col * 3) - 3;
        let z = (row * 2) - 1;
        
        let deskGroup = document.createElement('a-entity');
        deskGroup.setAttribute('position', `${x} 0 ${z}`);
        deskGroup.innerHTML = `
          <a-box position="0 0.5 0" width="1.2" height="0.8" depth="0.6" color="#8B4513"></a-box>
          <a-box position="-0.4 0.3 0.6" width="0.4" height="0.5" depth="0.4" color="#5D4037"></a-box>
          <a-box position="0.4 0.3 0.6" width="0.4" height="0.5" depth="0.4" color="#5D4037"></a-box>
        `;
        deskContainer.appendChild(deskGroup);
      }

      // 3. LOGIKA MASUK/KELUAR
      let lastPos = {x:0, y:1.6, z:15};

      function masukKelas(lantai, no) {
        alert("Masuk ke Kelas " + lantai + "0" + no);
        const rig = document.getElementById('rig');
        lastPos = rig.getAttribute('position'); // Simpan posisi luar
        
        document.getElementById('classroom-interior').setAttribute('visible', 'true');
        document.getElementById('school-building').setAttribute('visible', 'false');
        document.getElementById('papan-tulis').setAttribute('value', "KELAS " + lantai + "0" + no);
        
        rig.setAttribute('position', '100 1.6 104'); // Pindah ke interior
      }

      document.getElementById('exit-door').addEventListener('click', () => {
        alert("Keluar dari Kelas");
        document.getElementById('classroom-interior').setAttribute('visible', 'false');
        document.getElementById('school-building').setAttribute('visible', 'true');
        document.getElementById('rig').setAttribute('position', lastPos);
      });

      function start(role) {
        myRole = role;
        document.getElementById('ui-overlay').style.display = 'none';
        document.getElementById('chat-area').style.display = 'block';
        document.getElementById('exit-role').style.display = 'block';
      }

      function kirim() {
        const input = document.getElementById('chat-input');
        const txt = input.value;
        if(txt.trim() != "") {
            addMsg(myRole, txt);
            if((myRole==='Guru'||myRole==='Kepala Sekolah') && txt.startsWith("/papan ")) {
                document.getElementById('papan-tulis').setAttribute('value', txt.replace("/papan ",""));
            }
            input.value = "";
        }
      }

      function addMsg(s, t) {
        const b = document.getElementById('messages');
        b.innerHTML += `<div><b>[${s}]:</b> ${t}</div>`;
        b.scrollTop = b.scrollHeight;
      }
    </script>
  </body>
</html>
